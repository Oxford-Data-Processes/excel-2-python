classes:
  - name: ExcelFile
    type: dataclass
    description: "Represents an Excel file"
    attributes:
      - name: file_path
        type: str
      - name: workbook_with_formulas
        type: openpyxl.Workbook
      - name: workbook_with_values
        type: openpyxl.Workbook

  - name: Worksheet
    type: dataclass
    description: "Represents an Excel worksheet"
    attributes:
      - name: sheet_name
        type: str
      - name: workbook_file_path
        type: Optional[str]
      - name: worksheet
        type: Optional[openpyxl.Worksheet]

  - name: Cell
    type: dataclass
    description: "Represents an Excel cell"
    attributes:
      - name: column
        type: int
      - name: row
        type: int
      - name: coordinate
        type: str

  - name: CellRange
    type: dataclass
    description: "Represents a range of cells"
    attributes:
      - name: start_cell
        type: Cell
      - name: end_cell
        type: Cell

  - name: HeaderLocation
    type: enum
    description: "Represents the location of the header"
    attributes:
      - name: TOP
        value: "top"
      - name: LEFT
        value: "left"

  - name: Table
    type: dataclass
    description: "Represents a table"
    attributes:
      - name: name
        type: str
      - name: range
        type: CellRange
      - name: header_location
        type: HeaderLocation
      - name: header_values
        type: list[str]

  - name: SeriesDataType
    type: enum
    description: "Represents the data type of a series"
    attributes:
      - name: INT
        value: "int"
      - name: STR
        value: "str"
      - name: FLOAT
        value: "float"
      - name: BOOL
        value: "bool"

  - name: Series
    type: dataclass
    description: "Represents a series"
    attributes:
      - name: series_id
        type: str
      - name: worksheet
        type: Worksheet
      - name: series_header
        type: str
      - name: formulas
        type: list[str]
      - name: values
        type: list[Union[int, str, float, bool]]
      - name: header_location
        type: HeaderLocation
      - name: series_starting_cell
        type: Cell
      - name: series_length
        type: int
      - name: series_data_type
        type: SeriesDataType

  - name: SeriesRange
    type: dataclass
    description: "Represents a range of values for a collection of series"
    attributes:
      - name: series
        type: list[Series]
      - name: start_index
        type: int
      - name: end_index
        type: int

  - name: ASTGenerator
    type: regular
    description: "An object with a get_ast() method that returns the ast of the nth index"
    attributes:
      - name: formula_1_series
        type: xlcalculator.ast_nodes.ASTNode
      - name: formula_2_series
        type: xlcalculator.ast_nodes.ASTNode
    methods:
      - name: get_ast
        type: instance
        inputs:
          - name: index
            type: int
        outputs:
          - name: ast
            type: xlcalculator.ast_nodes.ASTNode

  - name: ASTGeneratorPython
    type: regular
    description: "An object with a get_ast_python() method but where the ast outputs has PythonFunction objects instead of FunctionNode objects."
    attributes:
      - name: series_id
        type: str
    methods:
      - name: get_ast_python
        type: instance
        inputs:
          - name: index
            type: int
          - name: ast
            type: xlcalculator.ast_nodes.ASTNode
        outputs:
          - name: ast_python
            type: xlcalculator.ast_nodes.ASTNode

  - name: ExcelLoader
    type: regular
    description: "Loads an Excel file"
    methods:
      - name: load_file
        type: static
        inputs:
          - name: file_path
            type: str
        outputs:
          - name: excel_file
            type: ExcelFile

  - name: ExcelCompatibilityChecker
    type: regular
    description: "Checks the compatibility of raw and reduced Excel files"
    methods:
      - name: check_file
        type: static
        inputs:
          - name: excel_raw
            type: ExcelFile
          - name: excel_reduced
            type: ExcelFile
          - name: extracted_tables
            type: dict[Worksheet, list[Table]]
        outputs:
          - name: is_compatible
            type: bool

  - name: ExcelValidator
    type: regular
    description: "Validates an Excel file"
    methods:
      - name: validate_excel
        type: static
        inputs:
          - name: excel_reduced
            type: ExcelFile
        outputs:
          - name: is_valid
            type: bool

  - name: SeriesExtractor
    type: regular
    description: "Extracts series from an Excel file"
    methods:
      - name: extract_series
        type: static
        inputs:
          - name: excel_reduced_clean
            type: ExcelFile
          - name: extracted_tables
            type: dict[Worksheet, list[Table]]
        outputs:
          - name: series_dict
            type: dict[str, list[Series]]

  - name: ExcelCleaner
    type: regular
    description: "Cleans an Excel file"
    methods:
      - name: clean_excel
        type: static
        inputs:
          - name: excel_reduced
            type: ExcelFile
        outputs:
          - name: excel_reduced_clean
            type: ExcelFile

  - name: TableFinder
    type: regular
    description: "Finds tables in an Excel file"
    methods:
      - name: find_tables
        type: static
        inputs:
          - name: excel_reduced_clean
            type: ExcelFile
        outputs:
          - name: extracted_tables
            type: dict[Worksheet, list[Table]]

  - name: SeriesMapper
    type: regular
    description: "Maps series to their respective worksheets"
    methods:
      - name: map_series
        type: static
        inputs:
          - name: series_dict
            type: dict[str, list[Series]]
        outputs:
          - name: series_mapping
            type: dict[Worksheet, dict[Cell, Tuple[int, Series]]]

  - name: SeriesIterator
    type: regular
    description: "Creates an iterator for a collection of series"
    methods:
      - name: iterate_series
        type: static
        inputs:
          - name: series_dict
            type: dict[str, list[Series]]
        outputs:
          - name: series_iterator
            type: Iterator[Series]

  - name: FormulaParser
    type: regular
    description: "Parses formulas in an Excel file"
    methods:
      - name: parse_formula
        type: static
        inputs:
          - name: formula
            type: str
        outputs:
          - name: formula_ast
            type: xlcalculator.ast_nodes.ASTNode

  - name: SeriesImplementer
    type: regular
    description: "Implements series in an AST"
    methods:
      - name: implement_series
        type: static
        inputs:
          - name: formula_ast
            type: xlcalculator.ast_nodes.ASTNode
          - name: series_dict
            type: dict[str, list[Series]]
        outputs:
          - name: formula_ast_series
            type: xlcalculator.ast_nodes.ASTNode

  - name: FormulaGenerator
    type: regular
    description: "Creates instances of ASTGenerator given two formula_ast objects"
    methods:
      - name: get_ast_generator
        type: static
        inputs:
          - name: formula_1_ast_series
            type: xlcalculator.ast_nodes.ASTNode
          - name: formula_2_ast_series
            type: xlcalculator.ast_nodes.ASTNode
        outputs:
          - name: ast_generator
            type: ASTGenerator

  - name: FormulaChecker
    type: regular
    description: "Checks formulas are correct by rebuilding Excel and checking equivalence, also checks that functions are in allowed list"
    methods:
      - name: check_formulas
        type: static
        inputs:
          - name: ast_generator
            type: ASTGenerator
          - name: series_mapping
            type: xlcalculator.ast_nodes.ASTNode
        outputs:
          - name: formulas_are_correct
            type: bool

  - name: FunctionReplacer
    type: regular
    description: "Replaces FunctionNode objects with PythonFunction objects in an AST"
    methods:
      - name: replace_functions
        type: static
        inputs:
          - name: ast_generator
            type: ASTGenerator
          - name: FunctionTranslator
            type: class
        outputs:
          - name: ast_generator_python
            type: ASTGeneratorPython

  - name: FunctionTranslator
    type: regular
    description: "Translates Excel function to Python function"
    methods:
      - name: translate_function
        type: static
        inputs:
          - name: excel_function
            type: xlcalculator.ast_nodes.FunctionNode
        outputs:
          - name: python_function
            type: Callable

  - name: ASTGeneratorCollector
    type: regular
    description: "An object that collects ASTGeneratorPython objects"
    methods:
      - name: collect_ast_generators
        type: instance
        inputs:
          - name: ast_generator_python
            type: ASTGeneratorPython
        outputs:
          - name: ast_generator_collection
            type: dict[str, ASTGeneratorPython]
      - name: get_collection
        type: instance
        inputs: []
        outputs:
          - name: ast_generator_collection
            type: dict[str, ASTGeneratorPython]

  - name: SeriesDependenciesBuilder
    type: regular
    description: "Builds dependencies of series"
    methods:
      - name: build_dependencies
        type: static
        inputs:
          - name: formula_1_ast_series_list
            type: list[(str, xlcalculator.ast_nodes.ASTNode)]
        outputs:
          - name: series_dependencies
            type: dict[str, list[str]]

  - name: DAGSorter
    type: regular
    description: "Sorts a directed acyclic graph"
    methods:
      - name: sort_dag
        type: static
        inputs:
          - name: series_dependencies
            type: dict[str, list[str]]
        outputs:
          - name: sorted_dag
            type: list[str]

  - name: AirflowProjectBuilder
    type: regular
    description: "Builds an Apache Airflow project"
    methods:
      - name: build_project
        type: static
        inputs:
          - name: sorted_dag
            type: list[str]
          - name: ast_generator_collection
            type: dict[str, ASTGeneratorPython]
        outputs:
          - name: airflow_project
            type: dict
